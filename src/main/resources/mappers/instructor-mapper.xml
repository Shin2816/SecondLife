<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- 해당 파일에 모든 쿼리문을 작성 -->
<mapper namespace="instructorMapper">
    <!-- 강사 테이블 -->
	<resultMap id="instructor" type="com.green.SecondLife.instructor.vo.InstructorVO">
        <id column="INSTRUCTOR_CODE"              property="instructorCode"/>
        <result column="INSTRUCTOR_MAJOR"         property="instructorMajor"/>
        <result column="INSTRUCTOR_NAME"          property="instructorName"/>
        <result column="INSTRUCTOR_AGE"           property="instructorAge"/>
        <result column="INSTRUCTOR_GENDER"        property="instructorGender"/>
        <result column="INSTRUCTOR_PHONE"         property="instructorPhone"/>
        <result column="INSTRUCTOR_ADDR"          property="instructorAddr"/>
        <result column="INSTRUCTOR_JOIN_DATE"     property="instructorJoinDate"/>
        <association property="instructorImgVO"   resultMap="instructorImg"/>
    </resultMap>
    <!-- 강좌 과목 테이블 -->
    <resultMap id="subject" type="com.green.SecondLife.instructor.vo.SubjectVO">
        <id column="SUBJECT_CODE"     property="subjectCode"/>
        <result column="SUBJECT_NAME" property="subjectName"/>
    </resultMap>
    <!-- 강사 이미지 테이블 -->
    <resultMap id="instructorImg" type="com.green.SecondLife.instructor.vo.InstructorImgVO">
        <id column="INSTRUCTOR_IMG_CODE"                property="instructorImgCode"/>
        <result column="INSTRUCTOR_CODE"                property="instructorCode"/>
        <result column="INSTRUCTOR_ORIGIN_FILE_NAME"    property="instructorOriginFileName"/>
        <result column="INSTRUCTOR_ATTACHED_FILE_NAME"  property="instructorAttachedFileName"/>
    </resultMap>
    <!-- 강사 등록 화면에서 전공 카테고리 조회 -->
    <select id="selectSubjectList" resultMap="subject">
        SELECT SUBJECT_CODE
            , SUBJECT_NAME
        FROM SUBJECT
    </select>
    <!-- 다음 강사 코드 조회 -->
    <select id="selectNextInstructorCode" resultType="String">
        SELECT 'INSTRUCTOR_'||LPAD(NVL(MAX(TO_NUMBER(SUBSTR(INSTRUCTOR_CODE, 12))), 0) + 1, 3,'0')
        FROM INSTRUCTOR
    </select>
    <!-- 강사 등록 쿼리 -->
    <insert id="insertInstructor">
        INSERT INTO INSTRUCTOR (
            INSTRUCTOR_CODE
            , INSTRUCTOR_MAJOR
            , INSTRUCTOR_NAME
            , INSTRUCTOR_AGE
            , INSTRUCTOR_GENDER
            , INSTRUCTOR_PHONE
            , INSTRUCTOR_ADDR
        ) VALUES (
            #{instructorCode}
            , #{instructorMajor}
            , #{instructorName}
            , #{instructorAge}
            , #{instructorGender}
            ,
            <foreach collection="instructorPhones" item="phone" separator="||'-'||">
                #{phone}
            </foreach>
            , #{instructorAddr}
        )
    </insert>
    <!-- 강사 이미지 등록 -->
    <insert id="insertInstructorImg">
        INSERT INTO INSTRUCTOR_IMG (
            INSTRUCTOR_IMG_CODE
            , INSTRUCTOR_CODE
            , INSTRUCTOR_ORIGIN_FILE_NAME
            , INSTRUCTOR_ATTACHED_FILE_NAME
        ) VALUES (
            (SELECT 'INSTRUCTOR_'||LPAD(NVL(MAX(TO_NUMBER(SUBSTR(INSTRUCTOR_CODE, 12))), 0) + 1, 3,'0')||'_IMG'
            FROM INSTRUCTOR_IMG)
            , #{instructorCode}
            , #{instructorImgVO.instructorOriginFileName}
            , #{instructorImgVO.instructorAttachedFileName}
        )
    </insert>
    <!-- 강사 목록 조회 쿼리 -->
    <select id="selectInstructorList" resultMap="instructor">
        SELECT INSTRUCTOR_CODE
            , INSTRUCTOR_NAME
            , INSTRUCTOR_MAJOR
            , INSTRUCTOR_AGE
            , INSTRUCTOR_GENDER
            , INSTRUCTOR_PHONE
            , INSTRUCTOR_ADDR
            , TO_CHAR (INSTRUCTOR_JOIN_DATE, 'YYYY-MM-DD') INSTRUCTOR_JOIN_DATE
        FROM INSTRUCTOR
    </select>
    <!-- 강사 상세 조회 쿼리 -->
    <select id="selectInstructorDetail" resultMap="instructor">
        SELECT INSTRUCTOR.INSTRUCTOR_CODE
            , INSTRUCTOR_NAME
            , INSTRUCTOR_MAJOR
            , INSTRUCTOR_AGE
            , INSTRUCTOR_GENDER
            , INSTRUCTOR_PHONE
            , INSTRUCTOR_ADDR
            , TO_CHAR (INSTRUCTOR_JOIN_DATE, 'YYYY-MM-DD') INSTRUCTOR_JOIN_DATE
            , INSTRUCTOR_ATTACHED_FILE_NAME
        FROM INSTRUCTOR, INSTRUCTOR_IMG
        WHERE INSTRUCTOR.INSTRUCTOR_CODE = #{instructorCode}
        AND INSTRUCTOR.INSTRUCTOR_CODE = INSTRUCTOR_IMG.INSTRUCTOR_CODE
    </select>
    <!-- 강사 이미지 코드 조회 -->
    <select id="selectInstructorImgCode" resultType="String">
        SELECT INSTRUCTOR_IMG_CODE
        FROM INSTRUCTOR_IMG
        WHERE INSTRUCTOR_CODE = #{instructorCode}
    </select>
    <!-- 강사 이미지 삭제 기능 -->
    <delete id="deleteInstructorImg">
        DELETE INSTRUCTOR_IMG
        WHERE INSTRUCTOR_IMG_CODE = #{instructorImgCode}
    </delete>
    <!-- 강사 삭제 기능 -->
    <delete id="deleteInstructor">
        DELETE INSTRUCTOR
        WHERE INSTRUCTOR_CODE = #{instructorCode}
    </delete>
</mapper>































