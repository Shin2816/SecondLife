<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- 해당 파일에 모든 쿼리문을 작성 -->
<mapper namespace="lectureMapper">
	<resultMap id="lecture" type="com.green.SecondLife.lecture.vo.LectureVO">
        <id column="LECTURE_CODE"           property="lectureCode"/>
        <result column="LECTURE_TITLE"      property="lectureTitle"/>
        <result column="LECTURE_SUBJECT"    property="lectureSubject"/>
        <result column="LECTURE_STUDENT"    property="lectureStudent"/>
        <result column="LECTURE_PERIOD"     property="lecturePeriod"/>
        <result column="LECTURE_PRICE"      property="lecturePrice"/>
        <result column="INSTRUCTOR_CODE"    property="instructorCode"/>
        <result column="INSTRUCTOR_NAME"    property="instructorName"/>
    </resultMap>
    <resultMap id="student" type="com.green.SecondLife.lecture.vo.StudentVO">
        <id column="STUDENT_CODE"       property="studentCode"/>
        <result column="STUDENT_NAME"       property="studentName"/>
        <result column="STUDENT_AGE"        property="studentAge"/>
        <result column="STUDENT_GENDER"     property="studentGender"/>
        <result column="STUDENT_TEL"        property="studentTel"/>
        <result column="STUDENT_ADDR"       property="studentAddr"/>
        <result column="MEMBER_ID"          property="memberId"/>
        <result column="LECTURE_CODE"       property="lectureCode"/>
    </resultMap>
    <!-- 강좌 등록 쿼리 -->
    <insert id="insertLecture">
        INSERT INTO LECTURE (
            LECTURE_CODE
            , LECTURE_TITLE
            , LECTURE_SUBJECT
            , LECTURE_STUDENT
            , LECTURE_PERIOD
            , LECTURE_PRICE
            , INSTRUCTOR_NAME
            , INSTRUCTOR_CODE
        ) VALUES (
            (SELECT 'LECTURE_'||LPAD(NVL(MAX(TO_NUMBER(SUBSTR(LECTURE_CODE, 9))), 0) + 1, 3,'0')
            FROM LECTURE)
            , #{lectureTitle}
            , #{lectureSubject}
            , #{lectureStudent}
            , #{lecturePeriod}
            , #{lecturePrice}
            , #{instructorName}
            , #{instructorCode}
        )
    </insert>
    <!-- 강좌 목록 조회 쿼리-->
    <select id="selectLectureList" resultMap="lecture">
        SELECT LECTURE_CODE
            , LECTURE_TITLE
            , LECTURE_SUBJECT
            , LECTURE_STUDENT
            , LECTURE_PERIOD
            , LECTURE_PRICE
            , INSTRUCTOR_CODE
            , INSTRUCTOR_NAME
        FROM LECTURE
        <if test="instructorCode != null">
            WHERE INSTRUCTOR_CODE = #{instructorCode}
        </if>
    </select>
    <!-- 강좌 상세 정보 조회 쿼리-->
    <select id="selectLectureDetail" resultMap="lecture">
        SELECT LECTURE_CODE
            , LECTURE_TITLE
            , LECTURE_SUBJECT
            , LECTURE_STUDENT
            , LECTURE_PERIOD
            , LECTURE_PRICE
            , INSTRUCTOR_CODE
            , INSTRUCTOR_NAME
        FROM LECTURE
        WHERE LECTURE_CODE = #{lectureCode}
    </select>
    <!-- 강좌 삭제 기능-->
    <delete id="deleteLecture">
        DELETE LECTURE
        WHERE LECTURE_CODE = #{lectureCode}
    </delete>
    <!-- 강좌 수강신청 -->
    <insert id="insertStudent">
        INSERT INTO STUDENT (
            STUDENT_CODE
            , STUDENT_NAME
            , STUDENT_AGE
            , STUDENT_GENDER
            , STUDENT_TEL
            , STUDENT_ADDR
            , MEMBER_ID
            , LECTURE_CODE
        ) VALUES (
            (SELECT 'STUDENT_'||LPAD(NVL(MAX(TO_NUMBER(SUBSTR(STUDENT_CODE, 9))), 0) + 1, 3,'0')
            FROM STUDENT)
            , #{studentName}
            , #{studentAge}
            , #{studentGender}
            , #{studentTel}
            , #{studentAddr}
            , #{memberId}
            , #{lectureCode}
        )
    </insert>
    <!-- 수강생 목록 조회 -->
    <select id="selectStudentList" resultMap="student">
        SELECT STUDENT_CODE
            , STUDENT_NAME
            , STUDENT_AGE
            , STUDENT_GENDER
            , STUDENT_TEL
            , STUDENT_ADDR
            , MEMBER_ID
            , LECTURE_CODE
        FROM STUDENT
        WHERE LECTURE_CODE = #{lectureCode}
    </select>
    <!-- 수강생 삭제 기능 -->
    <delete id="deleteStudent">
        DELETE STUDENT
        WHERE STUDENT_CODE = #{studentCode}
    </delete>
    <!--메인페이지 강좌 목록-->
    <select id="selectMainLectureList" resultMap="lecture">
        SELECT ROWNUM
            , LECTURE_CODE
            , LECTURE_TITLE
            , LECTURE_SUBJECT
            , LECTURE_STUDENT
            , LECTURE_PERIOD
            , LECTURE_PRICE
            , INSTRUCTOR_NAME
        FROM (
            SELECT ROWNUM AS ROW_NUM
                , LECTURE_CODE
                , LECTURE_TITLE
                , LECTURE_SUBJECT
                , LECTURE_STUDENT
                , LECTURE_PERIOD
                , LECTURE_PRICE
                , INSTRUCTOR_NAME
            FROM (
                SELECT *
                FROM LECTURE
                ORDER BY LECTURE_CODE DESC
            )
        )
        WHERE ROWNUM &lt;= 5
    </select>

</mapper>































